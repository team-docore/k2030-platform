"use strict";(()=>{var e={};e.id=732,e.ids=[732],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},45506:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>j,patchFetch:()=>O,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>q,staticGenerationBailout:()=>I});var s={};t.r(s),t.d(s,{DELETE:()=>f,GET:()=>m,PATCH:()=>d});var a=t(76423),i=t(90392),o=t(83393),n=t(63605),u=t(51485),l=t(92429),p=t(19602);function c(e){if(Array.isArray(e))return e.map(c);if(null!==e&&"object"==typeof e){let r={};for(let t in e)r[t.replace(/_([a-z])/g,(e,r)=>r.toUpperCase())]=c(e[t]);return r}return e}async function m(e,{params:r}){let{data:t,error:s}=await p.O.from("polls").select("*, categories(name)").eq("id",r.id).single();return s?n.Z.json({error:s.message},{status:404}):n.Z.json(c(t))}async function d(e,{params:r}){let t=await (0,u.getServerSession)(l.L);if(!t)return n.Z.json({error:"로그인이 필요합니다."},{status:401});let s=await e.json(),a={};for(let e of["question","options","endsAt","category_id"])void 0!==s[e]&&(a[e.replace(/[A-Z]/g,e=>"_"+e.toLowerCase())]=s[e]);a.updated_at=new Date().toISOString();let{data:i,error:o}=await p.O.from("polls").select("id, user_email").eq("id",r.id).single();if(o||!i)return n.Z.json({error:"투표를 찾을 수 없습니다."},{status:404});if(i.user_email!==t.user?.email)return n.Z.json({error:"수정 권한이 없습니다."},{status:403});let{data:m,error:d}=await p.O.from("polls").update(a).eq("id",r.id).eq("user_email",t.user?.email).select("*, categories(id, name)").single();return d?n.Z.json({error:d.message},{status:400}):n.Z.json(c(m))}async function f(e,{params:r}){let t=await (0,u.getServerSession)(l.L);if(!t)return n.Z.json({error:"로그인이 필요합니다."},{status:401});let{data:s,error:a}=await p.O.from("polls").select("id, user_email").eq("id",r.id).single();if(a||!s)return n.Z.json({error:"투표를 찾을 수 없습니다."},{status:404});if(s.user_email!==t.user?.email)return n.Z.json({error:"삭제 권한이 없습니다."},{status:403});let{error:i}=await p.O.from("poll_votes").delete().eq("poll_id",r.id);if(i)return n.Z.json({error:i.message},{status:400});let{error:o}=await p.O.from("polls").delete().eq("id",r.id).eq("user_email",t.user?.email);return o?n.Z.json({error:o.message},{status:400}):n.Z.json({ok:!0})}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/polls/[id]/route",pathname:"/api/polls/[id]",filename:"route",bundlePath:"app/api/polls/[id]/route"},resolvedPagePath:"/Users/dohyeonkim/k2030-platform/apps/web/app/api/polls/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:q,serverHooks:y,headerHooks:h,staticGenerationBailout:I}=g,j="/api/polls/[id]/route";function O(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:q})}},92429:(e,r,t)=>{t.d(r,{L:()=>i});var s=t(16335),a=t(19602);let i={debug:!0,providers:[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{prompt:"select_account",access_type:"offline",response_type:"code",scope:"openid email profile"}}})],pages:{signIn:"/auth/signin",error:"/auth/error"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}},callbackUrl:{name:"next-auth.callback-url",options:{sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},callbacks:{async signIn({user:e}){if(e?.email){let{data:r,error:t}=await a.O.from("users").select("status").eq("email",e.email).single();if(r){if("정지"===r.status)return`/auth/error?error=${encodeURIComponent("회원정지 중입니다. 관리자에게 문의하세요.")}`;if("탈퇴"===r.status)return`/auth/error?error=${encodeURIComponent("탈퇴회원입니다. 동일 이메일로 재가입 불가합니다.")}`}await a.O.from("users").upsert([{email:e.email,name:e.name}],{onConflict:"email"})}return!0},async session({session:e,token:r}){if(e?.user?.email){let{data:r,error:t}=await a.O.from("users").select("is_admin").eq("email",e.user.email).single();r&&(e.user={...e.user,isAdmin:r.is_admin})}return e},jwt:async({token:e,account:r})=>(r&&(e.accessToken=r.access_token),e)},events:{async signIn(e){},async signOut(e){},async createUser(e){},async updateUser(e){},async linkAccount(e){},async session(e){}}}},19602:(e,r,t)=>{t.d(r,{O:()=>s});let s=(0,t(4033).eI)("https://ixqsfzuwqnsujphdwvjo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4cXNmenV3cW5zdWpwaGR3dmpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzNzcyMTMsImV4cCI6MjA2MTk1MzIxM30.qmLjugw1dS0IyZT5u49Ae6FLOBROXDZqfQyDYtGxdEA")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[158,671,605,803],()=>t(45506));module.exports=s})();