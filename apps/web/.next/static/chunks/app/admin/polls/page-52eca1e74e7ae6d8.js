(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[736],{5361:function(n,t,e){Promise.resolve().then(e.bind(e,8718))},8718:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return u}});var r=e(7904),i=e(4725),o=e(3455),l=e(4889),a=e(618);function d(n){var t,e,d;let{initial:s,categories:c,onSubmit:u,onCancel:f}=n,[p,h]=(0,i.useState)((null==s?void 0:s.question)||""),[g,x]=(0,i.useState)((null==s?void 0:null===(t=s.categories)||void 0===t?void 0:t.id)||(null===(e=c[0])||void 0===e?void 0:e.id)||1),[m,y]=(0,i.useState)((null==s?void 0:null===(d=s.options)||void 0===d?void 0:d.map(n=>n.text))||["좋아요","몰라요","싫어요"]),b=(n,t)=>{y(e=>e.map((e,r)=>r===n?t:e))};return(0,r.jsx)(o.Z,{marginBottom:"1.5rem",children:(0,r.jsxs)("form",{onSubmit:n=>(n.preventDefault(),p.trim())?g?m.some(n=>!n.trim())?alert("모든 옵션을 입력하세요"):void u({question:p,categoryId:g,options:m}):alert("카테고리를 선택하세요"):alert("질문을 입력하세요"),children:[(0,r.jsx)(a.DK,{style:{marginBottom:16},children:s?"질문 수정":"질문 등록"}),(0,r.jsx)("div",{style:{marginBottom:12},children:(0,r.jsxs)("label",{children:["질문",(0,r.jsx)("br",{}),(0,r.jsx)("input",{value:p,onChange:n=>h(n.target.value),style:{width:"100%",padding:"0.7rem",borderRadius:8,border:"1px solid #e5e7eb",marginTop:4}})]})}),(0,r.jsx)("div",{style:{marginBottom:12},children:(0,r.jsxs)("label",{children:["카테고리",(0,r.jsx)("br",{}),(0,r.jsx)("select",{value:g,onChange:n=>x(Number(n.target.value)),style:{width:"100%",padding:"0.7rem",borderRadius:8,border:"1px solid #e5e7eb",marginTop:4},children:c.map(n=>(0,r.jsx)("option",{value:n.id,children:n.name},n.id))})]})}),(0,r.jsxs)("div",{style:{marginBottom:16},children:["옵션",(0,r.jsx)("br",{}),(0,r.jsx)("div",{style:{display:"flex",gap:8,marginTop:4},children:m.map((n,t)=>(0,r.jsx)("input",{value:n,onChange:n=>b(t,n.target.value),style:{flex:1,padding:"0.7rem",borderRadius:8,border:"1px solid #e5e7eb"}},t))})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,marginTop:8},children:[(0,r.jsx)(l.KM,{type:"submit",style:{flex:1},children:s?"수정 완료":"등록"}),(0,r.jsx)(l.KM,{type:"button",onClick:f,style:{flex:1,background:"#e5e7eb",color:"#222"},children:"취소"})]})]})})}function s(){let[n,t]=(0,i.useState)([]),[e,o]=(0,i.useState)(!0),[s,c]=(0,i.useState)(null),[u,f]=(0,i.useState)([]),[p,h]=(0,i.useState)(!1),[g,x]=(0,i.useState)(null),[m,y]=(0,i.useState)(null),[b,j]=(0,i.useState)(null),v=async()=>{try{o(!0),c(null);let n=await fetch("/api/polls");if(!n.ok)throw Error("투표 목록 불러오기 실패");let e=await n.json();t(e)}catch(n){c(n instanceof Error?n.message:"알 수 없는 오류")}finally{o(!1)}},w=async()=>{try{let n=await fetch("/api/categories");if(!n.ok)throw Error("카테고리 목록 불러오기 실패");let t=await n.json();f(t)}catch(n){f([])}};(0,i.useEffect)(()=>{v(),w()},[]);let k=async e=>{if(window.confirm("정말 삭제하시겠습니까?"))try{if(!(await fetch("/api/polls/".concat(e),{method:"DELETE"})).ok)throw Error("삭제 실패");t(n.filter(n=>n.id!==e))}catch(n){alert(n instanceof Error?n.message:"알 수 없는 오류")}},S=n=>{x(n),h(!0)},_=async n=>{try{if(g){if(!(await fetch("/api/polls/".concat(g.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n.question,category_id:n.categoryId,options:n.options})})).ok)throw Error("수정 실패")}else if(!(await fetch("/api/polls",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n.question,category_id:n.categoryId,options:n.options})})).ok)throw Error("등록 실패");h(!1),x(null),await v()}catch(n){alert(n instanceof Error?n.message:"알 수 없는 오류")}},P=async n=>{if(m===n.id){y(null),j(null);return}try{let t=await fetch("/api/polls/".concat(n.id));if(!t.ok)throw Error("상세 정보 불러오기 실패");let e=await t.json();y(n.id),j(e)}catch(t){y(n.id),j(n)}};return e?(0,r.jsx)("div",{children:"로딩 중..."}):s?(0,r.jsx)("div",{style:{color:"red"},children:s}):(0,r.jsx)("div",{style:{width:"100%"},children:(0,r.jsxs)("div",{style:{marginTop:16,color:"#666"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:0},children:[(0,r.jsx)(a.DK,{children:"투표 목록"}),(0,r.jsx)(l.KM,{style:{maxWidth:150,padding:"0.3rem 1.2rem",fontSize:14},onClick:()=>{x(null),h(!0)},children:"+ 질문 등록"})]}),p&&(0,r.jsx)(d,{initial:g||void 0,categories:u,onSubmit:_,onCancel:()=>{h(!1),x(null)}}),(0,r.jsx)("div",{style:{overflowX:"auto"},children:(0,r.jsxs)("table",{style:{width:"100%",marginTop:16,borderCollapse:"collapse"},children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{style:{background:"#f8fafc",color:"#222",fontWeight:700},children:[(0,r.jsx)("th",{style:{padding:"10px 8px",textAlign:"left"},children:"질문"}),(0,r.jsx)("th",{style:{padding:"10px 8px",textAlign:"left"},children:"카테고리"}),(0,r.jsx)("th",{style:{padding:"10px 8px",textAlign:"left"},children:"투표내용"}),(0,r.jsx)("th",{style:{padding:"10px 8px",textAlign:"left"},children:"총투표수"}),(0,r.jsx)("th",{style:{padding:"10px 8px",textAlign:"left"},children:"생성일"}),(0,r.jsx)("th",{style:{padding:"10px 8px",textAlign:"left"},children:"수정"}),(0,r.jsx)("th",{style:{padding:"10px 8px",textAlign:"left"},children:"삭제"})]})}),(0,r.jsx)("tbody",{children:n.map((n,t)=>{var e,i,o;return[(0,r.jsxs)("tr",{style:{borderBottom:"1px solid #eee",cursor:"pointer"},onClick:()=>P(n),children:[(0,r.jsx)("td",{style:{padding:"10px 8px",fontWeight:600},children:n.question}),(0,r.jsx)("td",{style:{padding:"10px 8px"},children:(0,r.jsx)(a.WD,{children:(null===(e=n.categories)||void 0===e?void 0:e.name)||"-"})}),(0,r.jsx)("td",{style:{padding:"10px 8px"},children:Array.isArray(n.options)?n.options.map(n=>"string"==typeof n?n:n.text).join(", "):"-"}),(0,r.jsx)("td",{style:{padding:"10px 8px",fontWeight:600},children:null!==(i=n.totalVotes)&&void 0!==i?i:0}),(0,r.jsx)("td",{style:{padding:"10px 8px"},children:(0,r.jsx)(a.vb,{children:function(n){if(!n)return"-";let t=new Date(n);return"".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")," ")+"".concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0"),":").concat(String(t.getSeconds()).padStart(2,"0"))}(n.createdAt)})}),(0,r.jsx)("td",{style:{padding:"10px 8px"},children:(0,r.jsx)(l.KM,{style:{padding:"0.3rem 1.2rem",fontSize:14},onClick:t=>{t.stopPropagation(),S(n)},children:"수정"})}),(0,r.jsx)("td",{style:{padding:"10px 8px"},children:(0,r.jsx)(l.KM,{style:{padding:"0.3rem 1.2rem",fontSize:14,background:"#e5e7eb",color:"#222"},onClick:t=>{t.stopPropagation(),k(n.id)},children:"삭제"})})]},n.id),m===n.id&&b&&(0,r.jsx)("tr",{children:(0,r.jsxs)("td",{colSpan:7,style:{background:"#f8fafc",padding:20},children:[(0,r.jsxs)("div",{style:{marginBottom:10,fontWeight:700,color:"#222"},children:["총 투표수: ",null!==(o=b.totalVotes)&&void 0!==o?o:0,"명"]}),(0,r.jsx)("div",{style:{maxWidth:480},children:Array.isArray(b.options)&&b.options.length>0?b.options.map((n,t)=>{var e,i;let o=null!==(e=n.votes)&&void 0!==e?e:0,l=null!==(i=b.totalVotes)&&void 0!==i?i:0,a=l>0?o/l*100:0;return(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,r.jsx)("span",{style:{width:80,fontWeight:600},children:n.text}),(0,r.jsx)("div",{style:{flex:1,background:"#e5e7eb",borderRadius:8,height:18,margin:"0 8px",position:"relative"},children:(0,r.jsx)("div",{style:{width:"".concat(a,"%"),background:"#4d8888",height:"100%",borderRadius:8,transition:"width 0.3s"}})}),(0,r.jsxs)("span",{style:{minWidth:40,textAlign:"right",fontWeight:600},children:[o,"명"]})]},n.id||t)}):(0,r.jsx)("span",{children:"옵션 없음"})})]})},n.id+"-stats")]})})]})})]})})}var c=e(3807);function u(){var n;let{data:t}=(0,c.useSession)();return(null==t?void 0:t.user)?(null===(n=t.user)||void 0===n?void 0:n.isAdmin)?(0,r.jsxs)(o.Z,{children:[(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",marginBottom:0},children:(0,r.jsx)(a.Dx,{children:"투표관리"})}),(0,r.jsx)("div",{style:{marginTop:16},children:(0,r.jsx)(s,{})})]}):(0,r.jsxs)("div",{style:{color:"red",fontWeight:700,textAlign:"center",marginTop:40},children:["접근 권한 없음 (관리자만 접근 가능)",(0,r.jsx)("br",{}),(0,r.jsx)("button",{style:{marginTop:24,padding:"10px 24px",fontWeight:600,borderRadius:8,background:"#4d8888",color:"#fff",border:"none",cursor:"pointer"},onClick:()=>{window.location.href="/"},children:"일반회원 페이지로 이동"})]}):(0,r.jsxs)("div",{style:{color:"red",fontWeight:700,textAlign:"center",marginTop:40},children:["로그인이 필요합니다",(0,r.jsx)("br",{}),(0,r.jsx)("button",{style:{marginTop:24,padding:"10px 24px",fontWeight:600,borderRadius:8,background:"#4d8888",color:"#fff",border:"none",cursor:"pointer"},onClick:()=>{window.location.href="/auth/signin"},children:"로그인 페이지로 이동"})]})}},4889:function(n,t,e){"use strict";e.d(t,{$m:function(){return u},KM:function(){return c},TX:function(){return f},yw:function(){return p}});var r=e(2260),i=e(8313);function o(){let n=(0,r._)(["\n  padding: 0.9rem 0;\n  width: 100%;\n  background: ",";\n  color: #ffffff;\n  font-weight: 800;\n  font-size: 1.1rem;\n  border-radius: 1rem;\n  border: none;\n  box-shadow: 0 2px 8px rgba(40, 96, 96, 0.08);\n  transition: background 0.2s, color 0.2s;\n  cursor: pointer;\n  &:hover {\n    background: ",";\n    color: ",";\n  }\n  &:disabled {\n    background: #e5e7eb;\n    color: #fff;\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n"]);return o=function(){return n},n}function l(){let n=(0,r._)(["\n  background: ",";\n  color: #fff;\n  &:hover {\n    background: ",";\n  }\n"]);return l=function(){return n},n}function a(){let n=(0,r._)(["\n  background: ",";\n  &:hover {\n    background: ",";\n  }\n"]);return a=function(){return n},n}function d(){let n=(0,r._)(["\n  flex: 1 1 0;\n  min-width: 0;\n  max-width: none;\n  border-radius: 0.5rem;\n  padding: 1.2rem 0;\n  font-weight: bold;\n  font-size: 1.1rem;\n  margin: 0 4px;\n  border: none;\n  box-shadow: none;\n  color: ",";\n  background: ",";\n  transition: all 0.2s;\n  &:hover {\n    opacity: 0.92;\n    box-shadow: none;\n  }\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n"]);return d=function(){return n},n}function s(){let n=(0,r._)(["\n  display: flex;\n  flex-direction: row;\n  gap: 8px;\n  width: 100%;\n  justify-content: space-between;\n  align-items: stretch;\n"]);return s=function(){return n},n}let c=i.ZP.button(o(),n=>{let{theme:t}=n;return t.primary},n=>{let{theme:t}=n;return t.primaryDark},n=>{let{theme:t}=n;return t.primaryLight}),u=(0,i.ZP)(c)(l(),n=>{let{theme:t}=n;return t.error},n=>{let{theme:t}=n;return t.primaryDark}),f=(0,i.ZP)(c)(a(),n=>{let{theme:t}=n;return t.primary},n=>{let{theme:t}=n;return t.primaryDark}),p=i.ZP.button(d(),n=>{let{theme:t,$type:e,$selected:r}=n;return r?"#000":"like"===e?t.primary:"neutral"===e?t.neutral:t.dislike},n=>{let{theme:t,$type:e,$selected:r}=n;return r?"like"===e?t.primary:"neutral"===e?t.neutral:t.dislike:t.background});i.ZP.div(s())},3455:function(n,t,e){"use strict";var r=e(2260);function i(){let n=(0,r._)(["\n  background: #fff;\n  border-radius: 1.5rem;\n  box-shadow: none;\n  padding: 2rem 1.5rem;\n  margin-bottom: ",";\n  border: none;\n"]);return i=function(){return n},n}let o=e(8313).ZP.div(i(),n=>{let{marginBottom:t}=n;return t||"2rem"});t.Z=o},618:function(n,t,e){"use strict";e.d(t,{DK:function(){return j},Dx:function(){return b},FN:function(){return w},HN:function(){return S},IK:function(){return C},J7:function(){return k},KH:function(){return A},WD:function(){return _},_1:function(){return Z},h4:function(){return z},u6:function(){return T},vb:function(){return P},vx:function(){return v},y:function(){return E}});var r=e(2260),i=e(8313);function o(){let n=(0,r._)(["\n  font-size: 2rem;\n  color: ",";\n  font-weight: 900;\n"]);return o=function(){return n},n}function l(){let n=(0,r._)(["\n  font-size: 1.1rem;\n  color: ",";\n  font-weight: 600;\n"]);return l=function(){return n},n}function a(){let n=(0,r._)(["\n  font-size: 0.8rem;\n  font-weight: 500;\n  color: ",";\n  background: ",";\n  padding: 0.5rem 1.4rem;\n  border-radius: 1.2rem;\n  min-width: 120px; // ← 원하는 값으로 추가\n  display: inline-block; // width 적용을 위해\n"]);return a=function(){return n},n}function d(){let n=(0,r._)(["\n  height: 100px;\n  width: auto;\n  max-width: 100%;\n  object-fit: contain;\n  @media (max-width: 600px) {\n    height: 48px;\n  }\n"]);return d=function(){return n},n}function s(){let n=(0,r._)(["\n  margin-top: 0.5rem;\n  font-size: 1rem;\n  font-weight: 700;\n  color: #222;\n  opacity: 0.9;\n"]);return s=function(){return n},n}function c(){let n=(0,r._)(["\n  font-weight: 700;\n  font-size: 1.25rem;\n  color: #222;\n  margin-bottom: 1.5rem;\n  line-height: 1.4;\n"]);return c=function(){return n},n}function u(){let n=(0,r._)(["\n  font-size: 0.9rem;\n  color: #3b82f6;\n  font-weight: 600;\n"]);return u=function(){return n},n}function f(){let n=(0,r._)(["\n  font-size: 0.9rem;\n  color: #a3a3a3;\n"]);return f=function(){return n},n}function p(){let n=(0,r._)(["\n  display: inline-block;\n  padding: 0.3rem 1rem;\n  font-size: 0.8rem;\n  font-weight: 600;\n  border-radius: 1rem;\n  background: #dbeafe;\n  color: #2563eb;\n"]);return p=function(){return n},n}function h(){let n=(0,r._)(["\n  display: inline-block;\n  padding: 0.3rem 1rem;\n  font-size: 0.8rem;\n  font-weight: 600;\n  border-radius: 1rem;\n  background: ",";\n  color: ",";\n"]);return h=function(){return n},n}function g(){let n=(0,r._)(["\n  color: #888;\n  font-size: 0.95rem;\n"]);return g=function(){return n},n}function x(){let n=(0,r._)(["\n  color: #a3a3a3;\n  font-size: 0.95rem;\n"]);return x=function(){return n},n}function m(){let n=(0,r._)(["\n  color: #e5e7eb;\n  margin: 0 0.3rem;\n"]);return m=function(){return n},n}function y(){let n=(0,r._)(["\n  color: #ef4444;\n  margin-top: 8px;\n  font-size: 13px;\n"]);return y=function(){return n},n}let b=i.ZP.h1(o(),n=>{let{theme:t}=n;return t.primary}),j=i.ZP.h2(l(),n=>{let{theme:t}=n;return t.primary}),v=i.ZP.span(a(),n=>{let{theme:t}=n;return t.text},n=>{let{theme:t}=n;return t.background}),w=i.ZP.img(d()),k=i.ZP.div(s()),S=i.ZP.div(c()),_=i.ZP.span(u()),P=i.ZP.span(f()),Z=i.ZP.span(p()),z=i.ZP.span(h(),n=>{let{$closed:t}=n;return t?"#fee2e2":"#dcfce7"},n=>{let{$closed:t}=n;return t?"#dc2626":"#16a34a"}),C=i.ZP.span(g()),A=i.ZP.span(x()),T=i.ZP.span(m()),E=i.ZP.div(y())},2260:function(n,t,e){"use strict";function r(n,t){return t||(t=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(t)}}))}e.d(t,{_:function(){return r}})}},function(n){n.O(0,[313,807,501,361,744],function(){return n(n.s=5361)}),_N_E=n.O()}]);